<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=750, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>会议管理系统</title>
  <link rel="stylesheet" href="./assets/css/style.scss">
</head>

<body class="register">

<div class="wrap">

  <div class="title v1336">会议管理系统</div>

  <div class="box2">
    <img src="assets/img/re-t.png" class="t2 v1336">
    <div class="title1 v750">注册</div>
    <div class="row">
      <div class="item">
        <div class="label">邮箱账号</div>
        <div class="input"><input type="text" placeholder="请输入邮箱账号" name="email"></div>
      </div>
      <div class="item">
        <div class="label">姓名</div>
        <div class="input"><input type="text" placeholder="请输入姓名" name="name"></div>
      </div>

    </div>
    <div class="row">
      <div class="item">
        <div class="label">手机号</div>
        <div class="input"><input type="text" placeholder="请输入手机号" name="tel"></div>
      </div>
      <!--      <div class="item">-->
      <!--        <div class="label">验证码</div>-->
      <!--        <div class="input"><input type="text" placeholder="请输入验证码"></div>-->
      <!--      </div>-->
      <div class="item">
        <div class="label">您的性别</div>
        <div class="input radio">
          <label><input type="radio" name="sex" value="1"><span>男</span></label> <label><input type="radio" name="sex" value="2"><span>女</span></label>
        </div>
      </div>
    </div>
    <button id="next">下一步</button>
  </div>

  <div class="box3">
    <img src="assets/img/re-t.png" class="t2 v1336">
    <div class="title1 v750">注册</div>
    <div class="row">
      <div class="item">
        <div class="label">工作单位</div>
        <div class="input"><input type="text" placeholder="请输入您的工作单位" name="org"></div>
      </div>
      <div class="item">
        <div class="label">科室/部门</div>
        <div class="input"><input type="text" placeholder="请输入科室/部门" name="dept"></div>
      </div>
    </div>
    <div class="row">
      <div class="item">
        <div class="label">职务</div>
        <div class="input radio">
          <div class="input"><input type="text" placeholder="请输入职务" name="job"></div>
        </div>
      </div>
      <div class="item">
        <div class="label">职称</div>
        <div class="input"><input type="text" placeholder="请输入职称" name="title"></div>
      </div>
    </div>
    <div class="row">
      <div class="item">
        <div class="label">最高学历</div>
        <div class="input education"><input type="text" placeholder="请输选择您的最高学历" name="qualifications"></div>
      </div>
    </div>
    <button id="submit">完成</button>
  </div>

</div>

<div class="alert" id="alert">
  <div class="box">
    <div class="msg"></div>
    <button id="ok">确定</button>
  </div>
</div>

<script>
  var nextBtn = document.querySelector('#next');
  var submitBtn = document.querySelector('#submit');
  var box2 = document.querySelector('.box2');
  var box3 = document.querySelector('.box3');
  var alertWrap = document.querySelector('#alert');
  var okBtn = document.querySelector('#ok');
  var box2Inputs = document.querySelector('.box2').querySelectorAll('input');
  var box3Inputs = document.querySelector('.box3').querySelectorAll('input');

  var data = {
    satatusName: '启用',
    status: 1,
  };

  nextBtn.onclick = function() {
    for (var i = 0; i < box2Inputs.length; i++) {
      var inp = box2Inputs[i];
      if (inp.name == 'sex') {
        if (inp.checked) {
          data.sex = inp.value;
          data.sexName = inp.nextSibling.innerText;
        }
      } else {
        data[inp.name] = inp.value;

        if (!inp.value) {
          alertF(inp.getAttribute('placeholder'), function() {
            alertWrap.style.display = 'none';
          });
          return;
        }
      }
    }

    if (!data.sex) {
      alertF('请选择性别', function() {
        alertWrap.style.display = 'none';
      });
      return;
    }

    box2.style.display = 'none';
    box3.style.display = 'block';
  };

  submitBtn.onclick = function() {

    for (var i = 0; i < box3Inputs.length; i++) {
      var inp = box3Inputs[i];
      data[inp.name] = inp.value;
      if (!inp.value) {
        alertF(inp.getAttribute('placeholder'), function() {
          alertWrap.style.display = 'none';
        });
      }
    }

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/gunsApi/addMetting', true);
    xhr.setRequestHeader('Content-type', 'application/json');
    xhr.setRequestHeader('Authorization', 'Authorization');
    xhr.onreadystatechange = function() {
      // readyState == 4说明请求已完成
      if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
        // 从服务器获得数据
        var data = xhr.responseText;
        data = JSON.parse(data);
        if (data.code == 200) {
          alertF('提交成功', function() {
            history.back();
          });
        }
      }
    };
    xhr.send(data);
  };


  function alertF(str, fun) {
    alertWrap.querySelector('.msg').innerText = str;
    alertWrap.style.display = 'block';

    okBtn.onclick = function() {
      fun();
      okBtn.onclick = null;
    };
  }
</script>

</body>

</html>
